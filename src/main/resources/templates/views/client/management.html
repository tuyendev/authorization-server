<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/layout :: head(~{this :: title}, ~{this :: .custom-link}, ~{this :: .custom-script})">
    <meta charset="UTF-8">
    <title>Client Management</title>

    <!-- DataTables -->
    <link class="custom-link" rel="stylesheet"
          th:href="@{/webjars/AdminLTE/3.2.0/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}"/>
    <link class="custom-link" rel="stylesheet"
          th:href="@{/webjars/AdminLTE/3.2.0/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}"/>
    <link class="custom-link" rel="stylesheet"
          th:href="@{/webjars/AdminLTE/3.2.0/plugins/datatables-buttons/css/buttons.bootstrap4.min.css}"/>

    <link class="custom-link" rel="stylesheet"
          th:href="@{/webjars/AdminLTE/3.2.0/plugins/datatables-select/css/select.bootstrap4.min.css}"/>


    <!-- DataTables  & Plugins -->
    <script class="custom-script" th:src="@{/webjars/AdminLTE/3.2.0/plugins/datatables/jquery.dataTables.min.js}"></script>
    <script class="custom-script" th:src="@{/webjars/AdminLTE/3.2.0/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
    <script class="custom-script" th:src="@{/webjars/AdminLTE/3.2.0/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
    <script class="custom-script" th:src="@{/webjars/AdminLTE/3.2.0/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>
    <script class="custom-script" th:src="@{/webjars/AdminLTE/3.2.0/plugins/datatables-buttons/js/dataTables.buttons.min.js}"></script>
    <script class="custom-script" th:src="@{/webjars/AdminLTE/3.2.0/plugins/datatables-buttons/js/buttons.bootstrap4.min.js}"></script>
    <script class="custom-script" th:src="@{/webjars/AdminLTE/3.2.0/plugins/datatables-select/js/dataTables.select.min.js}"></script>
    <script class="custom-script" th:src="@{/webjars/AdminLTE/3.2.0/plugins/datatables-select/js/select.bootstrap4.min.js}"></script>
    <script class="custom-script" th:src="@{/js/jquery.spring-friendly.min.js}"></script>
</head>
<body th:replace="~{fragments/layout :: body(~{:: #page-name}, ~{ :: #page-content}, ~{ :: #breadcrumb})}">
<span id="page-name">Client Management</span>
<ol class="breadcrumb float-sm-right" id="breadcrumb">
    <li class="breadcrumb-item"><a th:href="@{/}">Home</a></li>
    <li class="breadcrumb-item active">
        <span>Client Management</span>
    </li>
</ol>
<div id="page-content">
    <div th:insert="fragments/confirm-box ::#confirm-delete-box" ></div>
    <div class="card">
        <div class="card-header">
            <div class="card-title">
                <a th:href="@{/portal/client/add}" class="btn btn-primary active" role="button" aria-pressed="true">Add</a>
                <button id="deleteRows" type="button" class="btn btn-danger disabled " data-dismiss="modal">Delete</button>
            </div>
        </div>
        <!-- /.card-header -->
        <div class="card-body">

            <script>
                $(function () {
                    var tableClient = $('table#clientTableData').DataTable({
                        ajax: {
                            contentType: 'application/json',
                            url: '/api/client/list',
                            type: 'POST',
                            data: function (d) {
                                return JSON.stringify(d);
                            }
                        },
                        serverSide: true,
                        autoWidth: false,
                        info: true,
                        responsive: true,
                        select: true,
                        columns: [
                            {
                                data: 'id'
                            },
                            {
                                data: 'clientId'
                            },
                            {
                                data: 'clientName'
                            },
                            {
                                data: 'scopes'
                            },
                            {
                                data: 'authorizationGrantTypes'
                            },
                            {
                                data: 'createdDate'
                            },
                            {
                                data: 'lastModifiedDate'
                            },
                            {
                                data: 'actions',
                                searchable: false,
                                orderable: false,
                                render: function ( data, _, _, _ ) {
                                    return '<a href="/portal/client/edit/'+data+'"><i class="fas fa-pen-square"></i> Edit</a>';
                                }
                            }
                        ]
                    });
                    $('table#clientTableData tbody').on('click', 'tr', function () {
                        $(this).toggleClass('selected');
                        if(tableClient.rows('.selected').data().length > 0) {
                            $('#deleteRows').removeClass("disabled");
                        } else {
                            $('#deleteRows').addClass("disabled");
                        }
                    });
                    $('button#deleteRows').on('click', function (){
                        $('#confirm-delete-box').modal('show');
                    })
                    $('button#confirmed-delete').on('click', function (){
                        console.log("TODO Call AJax to delete");
                        $('#confirm-delete-box').modal('hide');
                    })
                });
            </script>
            <table id="clientTableData" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th style="width: 15%">ID</th>
                        <th style="width: 15%">ClientID</th>
                        <th style="width: 20%">Name</th>
                        <th style="width: 5%">Scopes</th>
                        <th>AuthorizationGrantTypes</th>
                        <th style="width: 10%">CreatedDate</th>
                        <th style="width: 10%">LastModifiedDate</th>
                        <th style="width: 5%">Actions</th>
                    </tr>
                </thead>
            </table>
        </div>

    </div>
</div>
</body>
</html>